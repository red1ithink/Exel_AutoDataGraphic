Sub SummarizeWeeklyCounts_Simple()

    ' 변수 선언
    Dim sourceWS As Worksheet
    Dim reportWS As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim reportRow As Long
    
    Dim startDate As Date, endDate As Date
    
    ' 의뢰, 완료 건수를 저장할 변수
    Dim requestCount As Long
    Dim completionCount As Long
    
    ' 셀의 날짜 값을 임시로 담을 변수
    Dim cellDate As Variant

    ' --- 1. 기본 설정 ---
    Set sourceWS = ThisWorkbook.ActiveSheet
    
    On Error Resume Next ' 시트가 없을 때 발생하는 에러를 잠시 무시
    Set reportWS = ThisWorkbook.Sheets("주간별 현황")
    On Error GoTo 0 ' 에러 처리 원상 복구
    
    If reportWS Is Nothing Then
        Set reportWS = ThisWorkbook.Sheets.Add(After:=sourceWS)
        reportWS.Name = "주간별 현황"
    End If
    reportWS.Cells.Clear
    
    ' --- 2. 리포트 시트에 제목(헤더) 추가 ---
    With reportWS
        .Range("A1").Value = "기간"
        .Range("B1").Value = "의뢰 건수"
        .Range("C1").Value = "완료 건수"
        .Range("A1:C1").Font.Bold = True
    End With
    reportRow = 2 ' 데이터는 2행부터 입력 시작
    
    ' --- 3. 주차별 데이터 집계 ---
    ' 데이터의 마지막 행을 G열 기준으로 찾음
    lastRow = sourceWS.Cells(sourceWS.Rows.Count, "G").End(xlUp).Row
    
    ' !!! 중요 !!! 데이터의 실제 연도와 맞는지 확인하세요.
    ' 2024년 데이터라면 DateSerial(2023, 12, 25) 등으로 변경해야 합니다.
    startDate = DateSerial(2024, 12, 30) ' 2025년 1월 1주차 시작일
    
    ' 10월 4주차가 끝날 때까지 반복
    Do While startDate < DateSerial(2025, 10, 27)
        endDate = startDate + 6 ' 해당 주차의 마지막 날
        
        ' 매 주차를 시작하기 전에 카운터 초기화
        requestCount = 0
        completionCount = 0
        
        ' 2행부터 데이터 마지막 행까지 순회
        For i = 2 To lastRow
            ' 의뢰 건수 집계 (G열)
            cellDate = sourceWS.Cells(i, "G").Value
            If Not IsError(cellDate) Then
                If IsDate(cellDate) Then
                    If Int(cellDate) >= startDate And Int(cellDate) <= endDate Then
                        requestCount = requestCount + 1
                    End If
                End If
            End If
            
            ' 완료 건수 집계 (H열)
            cellDate = sourceWS.Cells(i, "H").Value
            If Not IsError(cellDate) Then
                If IsDate(cellDate) Then
                    If Int(cellDate) >= startDate And Int(cellDate) <= endDate Then
                        completionCount = completionCount + 1
                    End If
                End If
            End If
        Next i
        
        ' --- 4. 리포트 시트에 집계된 데이터 입력 ---
        With reportWS
            Dim weekNum As Integer
            weekNum = Application.WorksheetFunction.RoundUp((Day(endDate) + Weekday(DateSerial(Year(endDate), Month(endDate), 1), 2) - 1) / 7, 0)
            .Cells(reportRow, "A").Value = Month(endDate) & "월 " & weekNum & "주 (" & Format(startDate, "mm/dd") & "~" & Format(endDate, "mm/dd") & ")"
            .Cells(reportRow, "B").Value = requestCount
            .Cells(reportRow, "C").Value = completionCount
        End With
        
        startDate = startDate + 7
        reportRow = reportRow + 1
    Loop
    
    ' --- 5. 마무리 작업 ---
    reportWS.Columns("A:C").AutoFit
    MsgBox "주간별 현황 집계가 완료되었습니다.", vbInformation
End Sub
