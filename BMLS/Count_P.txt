Sub Summarize_P_Column_Counts()

    ' =================================================================
    ' P열 'o' 조건 주간별 의뢰/완료 현황 집계
    ' 기능: P열이 'o'인 행에 대해서만 K열(의뢰일), L열(완료일)의
    '      날짜를 주차별로 카운트합니다.
    ' =================================================================

    ' 변수 선언
    Dim sourceWS As Worksheet
    Dim reportWS As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim reportRow As Long
    
    Dim startDate As Date, endDate As Date
    
    ' P='o' 조건의 의뢰/완료 건수를 저장할 변수
    Dim p_reqCount As Long
    Dim p_compCount As Long
    
    ' 셀의 값을 임시로 담을 변수
    Dim cellDate As Variant
    Dim pValue As String

    ' --- 1. 기본 설정 ---
    Set sourceWS = ThisWorkbook.ActiveSheet
    
    On Error Resume Next
    Set reportWS = ThisWorkbook.Sheets("주간별 현황")
    On Error GoTo 0
    
    If reportWS Is Nothing Then
        Set reportWS = ThisWorkbook.Sheets.Add(After:=sourceWS)
        reportWS.Name = "주간별 현황"
    End If
    reportWS.Cells.Clear
    
    ' --- 2. 리포트 시트에 제목(헤더) 추가 ---
    With reportWS
        .Range("A1").Value = "기간"
        .Range("B1").Value = "의뢰 건수 (P='o')"
        .Range("C1").Value = "완료 건수 (P='o')"
        .Range("A1:C1").Font.Bold = True
    End With
    reportRow = 2
    
    ' --- 3. 주차별 데이터 집계 ---
    ' 데이터의 마지막 행을 P열 기준으로 찾음
    lastRow = sourceWS.Cells(sourceWS.Rows.Count, "P").End(xlUp).Row
    
    ' !!! 중요 !!! 데이터의 실제 연도와 맞는지 확인하세요.
    ' 2024년 데이터라면 DateSerial(2023, 12, 25) 등으로 변경해야 합니다.
    startDate = DateSerial(2024, 12, 30) ' 2025년 데이터 기준
    
    ' 10월 4주차가 끝날 때까지 반복
    Do While startDate < DateSerial(2025, 10, 27)
        endDate = startDate + 6
        
        ' 매 주차 시작 전 카운터 초기화
        p_reqCount = 0
        p_compCount = 0
        
        ' 2행부터 데이터 마지막 행까지 순회
        For i = 2 To lastRow
            ' P열 값을 공백 제거, 소문자 변환하여 가져옴
            pValue = Trim(LCase(sourceWS.Cells(i, "P").Value))
            
            ' P열이 'o'일 경우에만 날짜 카운트를 진행
            If pValue = "o" Then
                ' 의뢰 건수 집계 (K열)
                cellDate = sourceWS.Cells(i, "K").Value
                If Not IsError(cellDate) Then
                    If IsDate(cellDate) Then
                        If Int(cellDate) >= startDate And Int(cellDate) <= endDate Then
                            p_reqCount = p_reqCount + 1
                        End If
                    End If
                End If
                
                ' 완료 건수 집계 (L열)
                cellDate = sourceWS.Cells(i, "L").Value
                If Not IsError(cellDate) Then
                    If IsDate(cellDate) Then
                        If Int(cellDate) >= startDate And Int(cellDate) <= endDate Then
                            p_compCount = p_compCount + 1
                        End If
                    End If
                End If
            End If
        Next i
        
        ' --- 4. 리포트 시트에 집계된 데이터 입력 ---
        With reportWS
            Dim weekNum As Integer
            weekNum = Application.WorksheetFunction.RoundUp((Day(endDate) + Weekday(DateSerial(Year(endDate), Month(endDate), 1), 2) - 1) / 7, 0)
            .Cells(reportRow, "A").Value = Month(endDate) & "월 " & weekNum & "주 (" & Format(startDate, "mm/dd") & "~" & Format(endDate, "mm/dd") & ")"
            .Cells(reportRow, "B").Value = p_reqCount
            .Cells(reportRow, "C").Value = p_compCount
        End With
        
        startDate = startDate + 7
        reportRow = reportRow + 1
    Loop
    
    ' --- 5. 마무리 작업 ---
    reportWS.Columns("A:C").AutoFit
    MsgBox "P열 'o' 조건 집계가 완료되었습니다.", vbInformation
End Sub
